{%- comment -%}
  PRODUCT CARD SNIPPET
  Usage: {% render 'product-card', product: product %}
  
  DEPENDENCIES:
  - Requires: sections-product.css for styling
  - Uses: Global theme settings for colors, typography
{%- endcomment -%}

{%- liquid
  assign product_url = product.url
  assign product_title = product.title
  assign product_vendor = product.vendor
  assign featured_image = product.featured_image
  assign price = product.price
  assign compare_at_price = product.compare_at_price
  assign available = product.available
  assign on_sale = false
  
  if compare_at_price > price
    assign on_sale = true
  endif
-%}

<div class="product-card" data-product-id="{{ product.id }}">
  <div class="product-card__media">
    <a href="{{ product_url }}" class="product-card__link" aria-label="{{ product_title | escape }}">
      {%- if featured_image != blank -%}
        <img
          srcset="
            {%- if featured_image.width >= 165 -%}{{ featured_image | image_url: width: 165 }} 165w,{%- endif -%}
            {%- if featured_image.width >= 330 -%}{{ featured_image | image_url: width: 330 }} 330w,{%- endif -%}
            {%- if featured_image.width >= 535 -%}{{ featured_image | image_url: width: 535 }} 535w,{%- endif -%}
            {%- if featured_image.width >= 750 -%}{{ featured_image | image_url: width: 750 }} 750w,{%- endif -%}
            {{ featured_image | image_url }} {{ featured_image.width }}w"
          src="{{ featured_image | image_url: width: 330 }}"
          sizes="(min-width: 1200px) 300px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
          alt="{{ featured_image.alt | escape }}"
          class="product-card__image"
          width="{{ featured_image.width }}"
          height="{{ featured_image.height }}"
          loading="lazy"
        >
        
        {%- comment -%} Hover image if available {%- endcomment -%}
        {%- if product.images[1] != blank -%}
          <img
            srcset="
              {%- if product.images[1].width >= 165 -%}{{ product.images[1] | image_url: width: 165 }} 165w,{%- endif -%}
              {%- if product.images[1].width >= 330 -%}{{ product.images[1] | image_url: width: 330 }} 330w,{%- endif -%}
              {%- if product.images[1].width >= 535 -%}{{ product.images[1] | image_url: width: 535 }} 535w,{%- endif -%}
              {%- if product.images[1].width >= 750 -%}{{ product.images[1] | image_url: width: 750 }} 750w,{%- endif -%}
              {{ product.images[1] | image_url }} {{ product.images[1].width }}w"
            src="{{ product.images[1] | image_url: width: 330 }}"
            sizes="(min-width: 1200px) 300px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
            alt="{{ product.images[1].alt | escape }}"
            class="product-card__image product-card__image--hover"
            width="{{ product.images[1].width }}"
            height="{{ product.images[1].height }}"
            loading="lazy"
          >
        {%- endif -%}
      {%- else -%}
        <div class="product-card__image-placeholder">
          {%- render 'icon-placeholder' -%}
        </div>
      {%- endif -%}
    </a>

    {%- comment -%} Product badges {%- endcomment -%}
    {%- if on_sale or available == false -%}
      <div class="product-card__badges">
        {%- if on_sale and available -%}
          <span class="product-card__badge product-card__badge--sale">
            {{ 'products.product.on_sale' | t }}
          </span>
        {%- endif -%}
        
        {%- unless available -%}
          <span class="product-card__badge product-card__badge--sold-out">
            {{ 'products.product.sold_out' | t }}
          </span>
        {%- endunless -%}
      </div>
    {%- endif -%}

    {%- comment -%} Quick add button {%- endcomment -%}
    {%- if available and product.variants.size == 1 -%}
      <div class="product-card__quick-add">
        <form action="{{ routes.cart_add_url }}" method="post" enctype="multipart/form-data" class="product-card__form">
          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          <button type="submit" class="btn btn--secondary btn--small product-card__quick-add-btn">
            {{ 'products.product.add_to_cart' | t }}
          </button>
        </form>
      </div>
    {%- endif -%}
  </div>

  <div class="product-card__content">
    {%- if product_vendor != blank and settings.show_vendor -%}
      <p class="product-card__vendor">{{ product_vendor | escape }}</p>
    {%- endif -%}

    <h3 class="product-card__title">
      <a href="{{ product_url }}" class="product-card__title-link">
        {{ product_title | escape }}
      </a>
    </h3>

    <div class="product-card__price">
      {%- if on_sale -%}
        <span class="product-card__price-current product-card__price--on-sale">
          {{ price | money }}
        </span>
        <span class="product-card__price-original">
          {{ compare_at_price | money }}
        </span>
        <span class="product-card__price-savings">
          {{ 'products.product.save_html' | t: saved_amount: compare_at_price | minus: price | money }}
        </span>
      {%- else -%}
        <span class="product-card__price-current">
          {%- if product.price_varies -%}
            {{ 'products.product.price.from_price_html' | t: price: price | money }}
          {%- else -%}
            {{ price | money }}
          {%- endif -%}
        </span>
      {%- endif -%}
    </div>

    {%- comment -%} Star rating if reviews app is installed {%- endcomment -%}
    {%- if product.metafields.reviews.rating.value != blank -%}
      <div class="product-card__rating">
        {% render 'product-rating', rating: product.metafields.reviews.rating.value, rating_count: product.metafields.reviews.rating_count.value %}
      </div>
    {%- endif -%}
  </div>
</div>